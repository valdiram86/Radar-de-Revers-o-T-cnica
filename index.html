
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel â€“ ReversÃ£o TÃ©cnica</title>

  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
      zoom: 90%;
    }

    h2 {
      margin-bottom: 10px;
    }

    select, input[type="text"] {
      padding: 8px;
      font-size: 16px;
      margin-bottom: 20px;
      margin-right: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
    }

    td, th {
      padding: 8px;
      text-align: center;
      border: 1px solid #ccc;
    }

    th {
      background-color: #eee;
    }

    .verde    { background-color: #32CD32; color: black; }
    .amarelo  { background-color: #FFFF66; color: black; }
    .laranja  { background-color: #FFA500; color: black; }
    .vermelho { background-color: #FF6347; color: black; }
    .escuro   { background-color: #006400; color: white; }

  </style>
</head>
<body>

  <h2>ðŸ“Š Painel TÃ©cnico â€“ ReversÃ£o por Faixa</h2>

  <label for="faixa">Faixa Ranking:</label>
  <select id="faixa">
    <option value="Top1_40">Top 1â€“40</option>
    <option value="Top41_100">Top 41â€“100</option>
    <option value="Top101_200">Top 101â€“200</option>
    <option value="Top201_350">Top 201â€“350</option>
    <option value="Top351_600">Top 351â€“600</option>
    <option value="Top601_1000">Top 601â€“1000</option>
    <option value="Top1001_2000">Top 1001â€“2000</option>
  </select>

  <input type="text" id="filtro" placeholder="Buscar por ranking ou sÃ­mbolo">

  <table id="tabela">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbwjMWqtplLEhijAGc5p8CNaxJfKxyhvZnCQKHnbVLec3jSDkoOy_DcjfjWfTg3rnnrr/exec?";

    async function carregarDados(abaSelecionada) {
      const url = `${endpoint}?aba=${abaSelecionada}`;
      const res = await fetch(url);
      const json = await res.json();
      const dados = json.dados;

      const tabela = $("#tabela").DataTable();
      tabela.clear().destroy();

      if (!dados || dados.length === 0) {
        $("#tabela thead").html("<tr><th>Sem dados disponÃ­veis</th></tr>");
        $("#tabela tbody").html("");
        return;
      }

      const colunas = Object.keys(dados[0]);
      const thead = colunas.map(c => `<th>${c}</th>`).join("");
      $("#tabela thead").html(`<tr>${thead}</tr>`);

      const tbody = dados.map(linha => {
        const linhaHtml = colunas.map((col, i) => {
          let valor = linha[col];
          if (typeof valor === "number") valor = valor.toFixed(2);
          return `<td>${valor}</td>`;
        }).join("");
        return `<tr>${linhaHtml}</tr>`;
      }).join("");

      $("#tabela tbody").html(tbody);

      $("#tabela").DataTable({
        paging: false,
        searching: true,
        info: false,
        order: [[4, "desc"]]
      });

      aplicarCores();
    }

    function aplicarCores() {
      $("#tabela tbody tr").each(function () {
        const score = parseFloat($(this).find("td:eq(4)").text());
        if (score >= 80) $(this).find("td:eq(4)").addClass("escuro");
        else if (score >= 60) $(this).find("td:eq(4)").addClass("verde");
        else if (score >= 40) $(this).find("td:eq(4)").addClass("amarelo");
        else if (score >= 20) $(this).find("td:eq(4)").addClass("laranja");
        else $(this).find("td:eq(4)").addClass("vermelho");
      });
    }

    document.getElementById("faixa").addEventListener("change", e => {
      carregarDados(e.target.value);
    });

    document.getElementById("filtro").addEventListener("keyup", function () {
      const valor = this.value.toLowerCase();
      $("#tabela").DataTable().search(valor).draw();
    });

    // Carrega inicial
    carregarDados("Top1_40");
  </script>

</body>
</html>
